<section class="p-5">
    <h2 class=" text-3xl font-bold"><%=typeof produto[0] != "undefined" && produto[0] ? produto[0].nome : ""  %></h2>

    <div class="p-2">
        <span class="line-through text-xl text-gray-700 font-semibold" >R$<%= (Number((produto[0].preco) *  1.10).toFixed(2)).replace('.', ',')  || "" %>
        </span>
        <span class="text-3xl text-gray-950 font-semibold " id="preco">R$<%= produto[0].preco.replace('.', ',') ?? ""  %></span>
    </div>
    <div class="p-2 text-gray-700 ">
        <div>
            <i class="bi bi-credit-card-2-front mr-1"></i>
            <span class="font-semibold ">3x de R$3,66 sem juros</span>
        </div>
        <div>
            <i class="bi bi-cash"></i>
            <span class="font-semibold ">2% de desconto Pagando com Pix</span>
        </div>
    </div>


    <div class="space-y-2 my-2">
        <!-- Tamanho -->
        <div>
            <label for="" class="text-sm text-gray-600">Tamanho</label>
            <select name="" id="tamanho" class="px-4 py-2 w-full border border-gray-500">
                <option value="" selected disabled>SELECIONE UM TAMANHO</option>

                <% 
                    const tamanhosUnicos = new Set();
                    produto.forEach(element => {
                        tamanhosUnicos.add(element.tamanho);
                    });
                %>
                <% tamanhosUnicos.forEach(tamanho => { %>
                    <option value="<%= tamanho %>"><%= tamanho %></option>
                <% }); %>

    
            </select>
        </div>
        <!-- Quantidade -->
        <div class="hidden" id="containerQuantidade">
            <label for="" class="text-sm text-gray-600">Quantidade</label>
            <select name=""  id="quantidade" class="px-4 py-2 w-full border border-gray-500">
                <option value="" selected disabled>SELECIONE UMA QUANTIDADE</option> 
            </select>
        </div>
    </div>

    <!-- Controle de quantidade -->
    <div class="flex items-center border border-black my-5" style="height: 50px;">
        <div class="flex items-center justify-around " style="height: 100%;">
            <button onclick="mais()"  class="text-3xl w-10 h-9 flex items-center justify-center"><i class="bi bi-plus-circle-fill leading-3"></i></button>
            <input id="quantidadeProduto" type="number" value="1" class=" text-center text-xl w-10 focus:outline-none">
            <button onclick="menos()"  class="text-3xl w-10 h-9 flex items-center justify-center"><i class="bi bi-dash-circle leading-3"></i></button>
        </div>
        <button onclick="comprar()" class="w-full bg-black px-4 font-bold text-white block h-full">COMPRAR</button>
    </div>


    <!-- Descrição -->
    <% if (produto[0].descricao) { %>
        <div class="my-10">
            <h2 class="text-3xl text-gray-700">Descrição do produto</h2>
            <p><%= produto[0].descricao ?? "" %></p>
        </div>
    <% } %>


<script>

    const produtoJSON = JSON.parse('<%- JSON.stringify(produto) %>');

    const item = {
        variante_id: "",
        preco: Number( produtoJSON[0].preco),
        quantidade: "",
        tamanho: "",
        quantidadeItens: 1
    }

    function mais(){
        let quantidade = parseInt(document.getElementById('quantidadeProduto').value);

        if(produtoJSON[0].estoque != "null" && produtoJSON[0].estoque > quantidade) {

            quantidade += 1;
            item.quantidadeItens = quantidade
            atualizar()
            document.getElementById('quantidadeProduto').value = quantidade;
        }else{
            alert('Produto indisponivel no momento!')
        }


    }
   
    function menos(){
        let quantidade = parseInt(document.getElementById('quantidadeProduto').value);
        if (quantidade > 1) {
            quantidade -= 1;
            item.quantidadeItens = quantidade
            atualizar()
            document.getElementById('quantidadeProduto').value = quantidade;
        }
    }

    function comprar(){
        if(produtoJSON[0].estoque == null ){
            alert('produto indisponivel!')
            return 
        }
        if(document.getElementById('tamanho').value == "") {
            alert("Selecione Tamanho")
            return
        }
        if(document.getElementById('quantidade').value == "") {
            alert("Selecione Quantidade")
            return
        }

        item.variante_id = document.getElementById('quantidade').value,
        item.quantidadeProduto = document.getElementById('quantidadeProduto').value

        
        const novoItem = {
            id: item.variante_id,
            nome: 'informacoesModal.nome',
            quantidade: item.quantidade,
            valor: item.preco,
            total: Number(item.preco) * Number(item.quantidadeItens)
        }

        if(!localStorage.carrinho){
            localStorage.carrinho = JSON.stringify([novoItem])
        }else{
            const carrinho = JSON.parse(localStorage.carrinho)
            carrinho.push(novoItem)
            localStorage.carrinho = JSON.stringify(carrinho)
        }
        atualizarIndicadorItensCarrinho()
        abrirCarrinho()

        

    }

    document.getElementById('tamanho').addEventListener('change', function() {
        document.getElementById('containerQuantidade').classList.remove('hidden')
        var quantidadeSelect = document.getElementById('quantidade');
        var tamanhoSelecionado = this.value;
        quantidadeSelect.innerHTML = '<option value="" selected disabled>SELECIONE UMA QUANTIDADE</option>';
        let options = ''
        produtoJSON.forEach(element => {
            if(element.tamanho == tamanhoSelecionado){
                quantidadeSelect
                options += `<option value="${element.variante_id}" >${element.quantidade}</option>`
            }
        });
        quantidadeSelect.innerHTML += options
    });

    document.getElementById('quantidade').addEventListener('change', function() {
        const id = this.value;
        const obj = produtoJSON.find((e)=> e.variante_id == id)
        item.quantidade = obj.quantidade
        item.tamanho = obj.tamanho
        item.variante_id = obj.variante_id
        item.preco = obj.preco
    })

    function atualizar(){
        const preco = document.getElementById('preco')
        preco.innerText = `R$ ${String(item.preco * item.quantidadeItens).replace('.', ',')}`
    }
</script>
