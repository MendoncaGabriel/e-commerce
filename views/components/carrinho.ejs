<style>
    #listaProdutosCarrinho {
        max-height: calc(100vh - 339px);
        overflow-y: auto; 
    }
</style>

<section id="carrinho" class="fixed top-0   right-[-100%] h-screen w-[90%] z-50 duration-300  bg-white flex flex-col justify-between max-w-screen-md ">
    
    <div class="text-right text-gray-700 text-xl flex flex-col">

        <button onclick="fecharCarrinho()" class="border-b p-2 pr-5 w-full text-right" >
            <i class="bi bi-x  text-4xl text-gray-700"></i>
        </button>

        <h2 class="w-full p-4 text-2xl text-center">MEU CARRINHO</h2>

        <!-- LISTA DE PRODUTOS NO CARRINHO -->
        <ul id="listaProdutosCarrinho" class="overflow-y-auto h-screen  ">
            <li class="py-2 px-4 border border-blue-500 rounded-full text-blue-500 flex items-center justify-between space-x-2 w-[80%] m-auto ">
                <i class="bi bi-exclamation-circle leading-3"></i>
                <p class="text-sm">O carrinho de compras esta vazio</p>
            </li>
        </ul>
      
    </div>

    <div>
        <div class="flex justify-between items-center font-semibold">
            <h2 class="p-4 text-xl " >Subtotal: </h2>
            <h2 class="p-4 text-xl " id="subtotal">R$0,00</h2>

        </div>
        <button class="bg-blue-500 px-4 py-2 w-full font-semibold text-white my-2">FINALIZAR COMPRA</button>
        <div>
            <img src="/logo.png" alt="logo" class="w-[50%] m-auto ">
        </div>
    </div>
</section>



<script>
    function fecharCarrinho(){
        const carrinho = document.getElementById('carrinho')
        carrinho.classList.add('right-[-100%]')

        setTimeout(() => {
            carrinho.classList.add('hidden')
        }, 300);
    }
    function abrirCarrinho(){
        carregarCarrinho()
        const carrinho = document.getElementById('carrinho')
        carrinho.classList.remove('hidden')
        
        setTimeout(() => {
            carrinho.classList.replace('right-[-100%]', 'right-0')
        }, 30);
    }

    function carregarCarrinho(){
        const listaProdutosCarrinho = document.getElementById('listaProdutosCarrinho')
        
        if(localStorage.carrinho && localStorage.carrinho != "[]"){
            const carrinho = JSON.parse(localStorage.carrinho)
                
            let subtotal = 0
            let lista = ''
            carrinho.forEach(e => {
                subtotal += Number(e.valor * e.quantidade)
                lista += `
                
                <li class=" text-left p-2 bg-gray-50 my-2 text-sm p-5 relative shadow-sm">
                    <p><b>Produto:</b> ${e.nome}</p>
                    <hr class="my-2">
                    <p><b>Quantidade:</b> ${e.quantidade}</p>
                    <p><b>Valor:</b> <span class=" font-semibold">R$${e.valor}</span></p>
                    <p><b>Total:</b> <span class="text-green-600 text-xl font-semibold">R$${e.total}</span></p>

                    <button onclick="removerDoCarrinho('${e.id}')" class=" ml-auto block absolute right-4 bottom-2">
                        <i class="bi bi-trash2-fill text-red-400 text-3xl"></i>
                    </button>
                </li>
                `
            });

            listaProdutosCarrinho.innerHTML = lista
            document.getElementById('subtotal').innerText = `R$${String(subtotal.toFixed(2)).replace('.', ',')}`

        

     

        }else{
            listaProdutosCarrinho.innerHTML = `
            <li class="py-2 px-4 border border-blue-500 rounded-full text-blue-500 flex items-center justify-between space-x-2 w-[80%] m-auto">
                <i class="bi bi-exclamation-circle leading-3"></i>
                <p class="text-sm">O carrinho de compras esta vazio</p>
            </li>
            `

            document.getElementById('subtotal').innerText = `R$00,00`
        }
    }


    function removerDoCarrinho(id){
        const carrinho = JSON.parse(localStorage.carrinho)
        let novoCarrinho = carrinho.filter(e => e.id !== id )
        localStorage.carrinho = JSON.stringify(novoCarrinho)

        carregarCarrinho()
        atualizarIndicadorItensCarrinho()
    }


    function adicionarAoCarinho(){
 
        const novoItem = {
            id: informacoesModal.id,
            nome: informacoesModal.nome,
            quantidade: informacoesModal.quantidade,
            valor: informacoesModal.valor,
            total: informacoesModal.total
        }

        if(!localStorage.carrinho){
            localStorage.carrinho = JSON.stringify([novoItem])
        }else{
            const carrinho = JSON.parse(localStorage.carrinho)
            carrinho.push(novoItem)
            localStorage.carrinho = JSON.stringify(carrinho)
        }
        atualizarIndicadorItensCarrinho()

        fecharModal()
    }
</script>
